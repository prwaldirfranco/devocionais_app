{% extends "base.html" %}
{% block content %}

<style>
  /* Garante que a largura se adapte ao celular */
  body {
    margin: 0;
    padding: 0;
  }

  .container-flex {
    display: flex;
    flex-wrap: wrap;
    gap: 30px;
  }

  /* No PC (largura acima de 900px) ‚Üí 3 colunas */
  @media (min-width: 900px) {
    .col-left { flex: 1; }
    .col-center { flex: 2; }
    .col-right { flex: 1; }
  }

  /* No tablet (entre 600px e 900px) ‚Üí 2 colunas */
  @media (max-width: 899px) and (min-width: 600px) {
    .col-left, .col-right { flex: 1 1 100%; }
    .col-center { flex: 2 1 100%; }
  }

  /* No celular (at√© 599px) ‚Üí tudo empilhado */
  @media (max-width: 599px) {
    .container-flex {
      flex-direction: column;
    }
    .col-left, .col-center, .col-right {
      flex: 1 1 100%;
    }
    img {
      max-width: 80%;
      margin: auto;
      display: block;
    }
  }
</style>

<div class="container-flex">

  <!-- Coluna vers√≠culo di√°rio (esquerda) -->
  <div class="col-left" style="background:#f0f8ff; padding:15px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1);">
    <h3 style="color:#2980b9;">üìñ Vers√≠culo do Dia</h3>
    <p id="versiculo-texto" style="font-size:16px; color:#2c3e50;">"{{ versiculo_texto }}"</p>
    <p id="versiculo-ref" style="font-size:14px; color:#555; text-align:right;">‚Äî {{ versiculo_ref }}</p>
  </div>

  <!-- Coluna devocionais (centro) -->
  <div class="col-center">
    <h2 style="color:#2c3e50;">üìú Devocionais e Prega√ß√µes</h2>

    <!-- Barra de pesquisa -->
    <form method="GET" style="margin-bottom:20px; display:flex; gap:10px;">
        <input type="text" name="q" placeholder="Pesquisar por t√≠tulo..." value="{{ query }}" style="flex:1; padding:8px; border-radius:6px; border:1px solid #ccc;">
        <button type="submit" style="padding:8px 12px; background:#2980b9; color:white; border:none; border-radius:6px;">Buscar</button>
    </form>

    {% for dev in devocionais %}
    <div style="background:#f9fafc; padding:15px; margin-bottom:12px; border-radius:8px; border:1px solid #dcdcdc; box-shadow:0 2px 6px rgba(0,0,0,0.05);">
        <a href="{{ url_for('view', devocional_id=dev[0]) }}" style="text-decoration:none; color:#2c3e50;">
            <h3 style="margin:0; display:flex; justify-content:space-between; align-items:center;">
                {{ dev[1] }}
                {% if dev[2] == 'devocional' %}
                    <span style="background:#27ae60; color:white; font-size:12px; padding:2px 6px; border-radius:4px;">Devocional</span>
                {% elif dev[2] == 'pregacao' %}
                    <span style="background:#2980b9; color:white; font-size:12px; padding:2px 6px; border-radius:4px;">Prega√ß√£o</span>
                {% endif %}
            </h3>
            {% if dev[3] %}
            <p style="margin-top:6px; color:#555;">{{ dev[3][:120] }}{% if dev[3]|length > 120 %}...{% endif %}</p>
            {% endif %}
        </a>

        <!-- Bot√£o de Curtida -->
        <div style="margin-top:10px;">
            <button class="like-btn" data-id="{{ dev[0] }}" style="background:#e74c3c; color:white; border:none; border-radius:6px; padding:6px 12px; cursor:pointer;">
                ‚ù§Ô∏è Curtir <span class="like-count">{{ curtidas_data.get(dev[0], 0) }}</span>
            </button>
        </div>
    </div>
    {% else %}
    <p>Nenhuma devocional encontrada.</p>
    {% endfor %}
  </div>

  <!-- Coluna sobre o pastor (direita) -->
  <div class="col-right" style="background:#eef2f7; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1);">
    <h2 style="color:#2c3e50;">Sobre o Pastor Waldir J√∫nior</h2>
    <img src="{{ url_for('static', filename='foto_pastor.jpg') }}" alt="Pastor Waldir" style="width:100%; border-radius:100%; margin-top:15px; margin-bottom:15px; box-shadow:0 2px 6px rgba(0,0,0,0.2);">
    <p style="text-align:justify; color:#333; line-height:1.5;">
      Pr. Waldir J√∫nior √© l√≠der da Comunidade Batista Vida Efat√°, pastor h√° 11 anos e dedicado a compartilhar a Palavra de Deus com amor e sabedoria. 
      Ministrando devocionais, prega√ß√µes e estudos b√≠blicos, ele guia a igreja com zelo pastoral e cora√ß√£o mission√°rio.
    </p>
    <p style="text-align:justify; color:#333; line-height:1.5;">
      Seu objetivo √© ajudar pessoas a crescerem espiritualmente, alcan√ßando restaura√ß√£o, f√© pr√°tica e intimidade com Cristo. 
      Autor de materiais devocionais e livros voltados para l√≠deres e crist√£os que buscam aprofundar sua caminhada com Deus.
    </p>
  </div>

</div>

<script>
// Curtidas
const buttons = document.querySelectorAll('.like-btn');
buttons.forEach(btn => {
    btn.addEventListener('click', () => {
        const devId = btn.dataset.id;
        fetch(`/like/${devId}`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                btn.querySelector('.like-count').textContent = data.likes;
                btn.style.background = '#c0392b';
            });
    });
});

// Atualizar vers√≠culo automaticamente a cada 24h (86400000ms)
async function atualizarVersiculo() {
    try {
        const resp = await fetch('/api/versiculo');
        const data = await resp.json();
        if (data.texto && data.referencia) {
            document.getElementById('versiculo-texto').textContent = `"${data.texto}"`;
            document.getElementById('versiculo-ref').textContent = `‚Äî ${data.referencia}`;
        }
    } catch (e) {
        console.error('Erro ao atualizar vers√≠culo', e);
    }
}

// Atualiza na primeira carga
atualizarVersiculo();

// Intervalo para atualizar a cada 24 horas
setInterval(atualizarVersiculo, 86400000);
</script>

{% endblock %}
